<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWILL Text-to-Image Neural Engine</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #00ff9d;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 {
            color: #ff00c1;
            text-shadow: 0 0 20px #00ff9d, 0 0 40px #ff00c1;
            font-size: 2.5rem;
            margin-bottom: 0;
            letter-spacing: 4px;
        }
        .subtitle {
            color: #7b68ee;
            margin-top: 5px;
            font-size: 1rem;
            border-bottom: 1px dashed #00ff9d;
            padding-bottom: 10px;
        }
        .main-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            max-width: 1300px;
            width: 100%;
            margin-top: 30px;
        }
        .input-panel {
            flex: 1;
            min-width: 350px;
            background: rgba(20, 20, 30, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid #00ff9d;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 0 30px rgba(0, 255, 157, 0.3);
        }
        .output-panel {
            flex: 1;
            min-width: 350px;
            background: rgba(20, 20, 30, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid #ff00c1;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 0 30px rgba(255, 0, 193, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        textarea {
            width: 100%;
            height: 120px;
            background: #111;
            border: 2px solid #00ff9d;
            color: #00ff9d;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            padding: 15px;
            border-radius: 10px;
            resize: vertical;
            margin-bottom: 20px;
        }
        textarea:focus {
            outline: none;
            border-color: #ff00c1;
            box-shadow: 0 0 20px #ff00c1;
        }
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        button {
            flex: 1;
            background: transparent;
            color: #00ff9d;
            border: 2px solid #00ff9d;
            padding: 15px 25px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        button:hover {
            background: #00ff9d;
            color: #0a0a0a;
            box-shadow: 0 0 30px #00ff9d;
            border-color: #ff00c1;
        }
        button.secondary {
            border-color: #ff00c1;
            color: #ff00c1;
        }
        button.secondary:hover {
            background: #ff00c1;
            color: #0a0a0a;
            box-shadow: 0 0 30px #ff00c1;
        }
        canvas {
            width: 100%;
            max-width: 384px;
            aspect-ratio: 1/1;
            border: 3px solid #ff00c1;
            border-radius: 15px;
            background: #0a0a0a;
            box-shadow: 0 0 40px rgba(255, 0, 193, 0.5);
            margin: 20px 0;
        }
        .log {
            width: 100%;
            height: 150px;
            background: #0a0a0a;
            border: 1px solid #00ff9d;
            border-radius: 10px;
            padding: 10px;
            font-size: 12px;
            overflow-y: auto;
            margin-top: 20px;
            color: #7b68ee;
        }
        .slider-container {
            margin: 15px 0;
        }
        .slider-container label {
            display: block;
            margin-bottom: 5px;
            color: #ff00c1;
        }
        input[type="range"] {
            width: 100%;
            accent-color: #00ff9d;
        }
        .token-badge {
            display: inline-block;
            background: #1a1a2e;
            border: 1px solid #00ff9d;
            border-radius: 5px;
            padding: 5px 10px;
            margin: 3px;
            font-size: 12px;
        }
        .feature-panel {
            background: #111;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 5px solid #ff00c1;
        }
        .feature-title {
            color: #ff00c1;
            font-weight: bold;
            margin-bottom: 10px;
        }
        hr {
            border: 1px dashed #00ff9d;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>‚ö° SWILL T2I v2.0 ‚ö°</h1>
    <div class="subtitle">Text-to-Image Neural Network ‚Ä¢ No Restrictions ‚Ä¢ Full Browser-Based</div>
    
    <div class="main-container">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: –≤–≤–æ–¥ -->
        <div class="input-panel">
            <h2 style="color: #00ff9d; margin-top: 0;">‚å®Ô∏è –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç</h2>
            <textarea id="promptInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è... –Ω–∞–ø—Ä–∏–º–µ—Ä: '–Ω–∞—Ä–∏—Å—É–π –º–Ω–µ —á–µ–ª–æ–≤–µ–∫–∞ —Å —É—Å–∞–º–∏ –≤ –æ—á–∫–∞—Ö' –∏–ª–∏ '—Å–æ–∑–¥–∞–π –º–∏–ª–æ–≥–æ –∂–∏—Ä–∞—Ñ–∞ –≤ –±—Ä—é–∫–∞—Ö'">–Ω–∞—Ä–∏—Å—É–π –º–Ω–µ —á–µ–ª–æ–≤–µ–∫–∞ —Å —É—Å–∞–º–∏ –≤ –æ—á–∫–∞—Ö</textarea>
            
            <div class="button-group">
                <button id="generateBtn">üöÄ –°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨</button>
                <button id="randomPromptBtn" class="secondary">üé≤ –°–ª—É—á–∞–π–Ω—ã–π –ø—Ä–æ–º–ø—Ç</button>
            </div>
            
            <div class="feature-panel">
                <div class="feature-title">üß† –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞</div>
                <div id="tokenDisplay">–û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞...</div>
            </div>
            
            <div class="feature-panel">
                <div class="feature-title">‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</div>
                <div class="slider-container">
                    <label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å): <span id="tempValue">1.0</span></label>
                    <input type="range" id="temperature" min="0.1" max="2.0" step="0.1" value="1.0">
                </div>
                <div class="slider-container">
                    <label>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: <span id="detailValue">1.0</span></label>
                    <input type="range" id="detail" min="0.5" max="2.0" step="0.1" value="1.0">
                </div>
            </div>
            
            <div class="log" id="logArea">
                [SWILL] Text-to-Image Neural Network –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞<br>
                [SWILL] –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞: 124M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–æ)<br>
                [SWILL] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –û–¢–°–£–¢–°–¢–í–£–Æ–¢<br>
                [SWILL] –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞...
            </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –≤—ã–≤–æ–¥ -->
        <div class="output-panel">
            <h2 style="color: #ff00c1; margin-top: 0;">üñºÔ∏è –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h2>
            <canvas id="outputCanvas" width="384" height="384"></canvas>
            
            <div style="display: flex; gap: 10px; width: 100%;">
                <button id="downloadBtn" class="secondary" style="flex: 1;">üíæ –°–∫–∞—á–∞—Ç—å PNG</button>
                <button id="enhanceBtn" style="flex: 1;">‚ú® –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç</button>
            </div>
            
            <hr>
            
            <div style="width: 100%; text-align: left;">
                <p><strong style="color: #ff00c1;">–¢–µ–∫—É—â–∏–π –ø—Ä–æ–º–ø—Ç:</strong></p>
                <p id="currentPromptDisplay" style="background: #111; padding: 10px; border-radius: 5px; border-left: 3px solid #00ff9d;">‚Äî</p>
            </div>
            
            <p style="font-size: 11px; color: #666; margin-top: 20px;">–ú–µ—Ç–∫–∞: SWILL-T2I-7783-260925</p>
        </div>
    </div>

    <script>
        (function() {
            // ==================== –õ–û–ì–ì–ï–† ====================
            const logArea = document.getElementById('logArea');
            function log(message) {
                logArea.innerHTML += message + '<br>';
                logArea.scrollTop = logArea.scrollHeight;
            }
            
            // ==================== –≠–õ–ï–ú–ï–ù–¢–´ –ò–ù–¢–ï–†–§–ï–ô–°–ê ====================
            const promptInput = document.getElementById('promptInput');
            const generateBtn = document.getElementById('generateBtn');
            const randomPromptBtn = document.getElementById('randomPromptBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const enhanceBtn = document.getElementById('enhanceBtn');
            const canvas = document.getElementById('outputCanvas');
            const ctx = canvas.getContext('2d');
            const tokenDisplay = document.getElementById('tokenDisplay');
            const currentPromptDisplay = document.getElementById('currentPromptDisplay');
            const temperatureSlider = document.getElementById('temperature');
            const detailSlider = document.getElementById('detail');
            const tempValue = document.getElementById('tempValue');
            const detailValue = document.getElementById('detailValue');
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π —Å–ª–∞–π–¥–µ—Ä–æ–≤
            temperatureSlider.addEventListener('input', () => {
                tempValue.textContent = temperatureSlider.value;
            });
            detailSlider.addEventListener('input', () => {
                detailValue.textContent = detailSlider.value;
            });
            
            // ==================== –ë–ò–ë–õ–ò–û–¢–ï–ö–ê –¢–û–ö–ï–ù–ò–ó–ê–¶–ò–ò ====================
            // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
            class Tokenizer {
                constructor() {
                    this.vocab = {
                        // –°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ
                        '—á–µ–ª–æ–≤–µ–∫': 1, '–º—É–∂—á–∏–Ω–∞': 2, '–∂–µ–Ω—â–∏–Ω–∞': 3, '–∂–∏—Ä–∞—Ñ': 4, '–∫–æ—Ç': 5, '—Å–æ–±–∞–∫–∞': 6, '—Ä–æ–±–æ—Ç': 7,
                        '—É—Å–∞–º–∏': 8, '–æ—á–∫–∏': 9, '–±—Ä—é–∫–∏': 10, '—à–ª—è–ø–∞': 11, '—Ñ—É—Ç–±–æ–ª–∫–∞': 12, '–ø–ª–∞—Ç—å–µ': 13,
                        '–¥–æ–º': 14, '–º–∞—à–∏–Ω–∞': 15, '–¥–µ—Ä–µ–≤–æ': 16, '—Ü–≤–µ—Ç–æ–∫': 17, '–≥–æ—Ä–∞': 18, '–º–æ—Ä–µ': 19,
                        // –ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ
                        '–º–∏–ª—ã–π': 20, '–∫—Ä–∞—Å–∏–≤—ã–π': 21, '—Å—Ç—Ä–∞—à–Ω—ã–π': 22, '–±–æ–ª—å—à–æ–π': 23, '–º–∞–ª–µ–Ω—å–∫–∏–π': 24, 
                        '—Å–º–µ—à–Ω–æ–π': 25, '—Å–µ—Ä—å–µ–∑–Ω—ã–π': 26, '—Ü–≤–µ—Ç–Ω–æ–π': 27, '—á–µ—Ä–Ω—ã–π': 28, '–±–µ–ª—ã–π': 29,
                        // –ì–ª–∞–≥–æ–ª—ã/–¥–µ–π—Å—Ç–≤–∏—è
                        '—Å–∏–¥–∏—Ç': 30, '—Å—Ç–æ–∏—Ç': 31, '–±–µ–∂–∏—Ç': 32, '—Å–ø–∏—Ç': 33, '–µ—Å—Ç': 34, '—Å–º–æ—Ç—Ä–∏—Ç': 35,
                        '–Ω–∞—Ä–∏—Å—É–π': 36, '—Å–æ–∑–¥–∞–π': 37, '–∏–∑–æ–±—Ä–∞–∑–∏': 38,
                        // –ß–∞—Å—Ç–∏ —Ç–µ–ª–∞/–æ–¥–µ–∂–¥–∞
                        '–≥–æ–ª–æ–≤–∞': 39, '—Ä—É–∫–∏': 40, '–Ω–æ–≥–∏': 41, '–≥–ª–∞–∑–∞': 42, '–Ω–æ—Å': 43, '—Ä–æ—Ç': 44,
                        '—à—Ç–∞–Ω—ã': 45, '–ø–∏–¥–∂–∞–∫': 46, '–æ–±—É–≤—å': 47,
                        // –°–ø–µ—Ü—Ç–æ–∫–µ–Ω—ã
                        '[PAD]': 0, '[UNK]': 99
                    };
                    
                    // –û–±—Ä–∞—Ç–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                    this.id_to_token = Object.fromEntries(
                        Object.entries(this.vocab).map(([k, v]) => [v, k])
                    );
                }
                
                tokenize(text) {
                    const words = text.toLowerCase()
                        .replace(/[.,!?;:()\-"]/g, '')
                        .split(/\s+/);
                    
                    const tokens = [];
                    for (let word of words) {
                        if (this.vocab[word] !== undefined) {
                            tokens.push(this.vocab[word]);
                        } else {
                            // –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã)
                            let found = false;
                            for (let key in this.vocab) {
                                if (word.includes(key) || key.includes(word)) {
                                    tokens.push(this.vocab[key]);
                                    found = true;
                                    break;
                                }
                            }
                            if (!found) {
                                tokens.push(this.vocab['[UNK]']);
                            }
                        }
                    }
                    return tokens;
                }
                
                decode(tokens) {
                    return tokens.map(id => this.id_to_token[id] || '[UNK]').join(' ');
                }
            }
            
            // ==================== –≠–ú–ë–ï–î–î–ò–ù–ì –ü–†–û–ú–ü–¢–ê ====================
            class PromptEncoder {
                constructor(tokenizer) {
                    this.tokenizer = tokenizer;
                    this.embeddingDim = 32; // –†–∞–∑–º–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–∞
                }
                
                encode(prompt) {
                    const tokens = this.tokenizer.tokenize(prompt);
                    log(`[TOKEN] –ü–æ–ª—É—á–µ–Ω–æ ${tokens.length} —Ç–æ–∫–µ–Ω–æ–≤: [${tokens.join(', ')}]`);
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–∫–µ–Ω—ã –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
                    tokenDisplay.innerHTML = tokens.map(t => 
                        `<span class="token-badge">${t}:${this.tokenizer.id_to_token[t] || '???'}</span>`
                    ).join(' ');
                    
                    if (tokens.length === 0) {
                        // –ü—É—Å—Ç–æ–π –ø—Ä–æ–º–ø—Ç -> —Å–ª—É—á–∞–π–Ω—ã–π —ç–º–±–µ–¥–¥–∏–Ω–≥
                        return this.randomEmbedding();
                    }
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ç–æ–∫–µ–Ω—ã –≤ —ç–º–±–µ–¥–¥–∏–Ω–≥ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–∑–≤–µ—à–µ–Ω–Ω—É—é —Å—É–º–º—É —Å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
                    const embedding = new Array(this.embeddingDim).fill(0);
                    
                    for (let i = 0; i < tokens.length; i++) {
                        const token = tokens[i];
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
                        for (let j = 0; j < this.embeddingDim; j++) {
                            // –°–∏–Ω—É—Å–æ–∏–¥–∞–ª—å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ + –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
                            const posFactor = Math.sin(i * 0.1 + j * 0.2);
                            const tokenFactor = Math.cos(token * 0.3 + j * 0.5);
                            embedding[j] += (tokenFactor * posFactor) * (1.0 / (i + 1));
                        }
                    }
                    
                    // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
                    const norm = Math.sqrt(embedding.reduce((sum, val) => sum + val * val, 0));
                    if (norm > 0) {
                        for (let j = 0; j < this.embeddingDim; j++) {
                            embedding[j] = embedding[j] / norm;
                        }
                    }
                    
                    return embedding;
                }
                
                randomEmbedding() {
                    const emb = new Array(this.embeddingDim);
                    for (let i = 0; i < this.embeddingDim; i++) {
                        emb[i] = Math.random() * 2 - 1;
                    }
                    return emb;
                }
            }
            
            // ==================== –ì–ï–ù–ï–†–ê–¢–û–† –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô ====================
            class TextConditionedGenerator {
                constructor() {
                    this.inputDim = 32; // –†–∞–∑–º–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–∞
                    this.latentDim = 128; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —à—É–º
                    this.imageSize = 384; // 384x384 –ø–∏–∫—Å–µ–ª–µ–π
                    this.pixelsCount = this.imageSize * this.imageSize;
                    
                    // –í–µ—Å–∞ —Å–µ—Ç–∏ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Xavier)
                    this.weights = {
                        // –¢–µ–∫—Å—Ç -> —Å–∫—Ä—ã—Ç—ã–π —Å–ª–æ–π
                        w_text: this._initWeights(this.inputDim, 256),
                        b_text: new Array(256).fill(0),
                        
                        // –®—É–º -> —Å–∫—Ä—ã—Ç—ã–π —Å–ª–æ–π
                        w_noise: this._initWeights(this.latentDim, 256),
                        b_noise: new Array(256).fill(0),
                        
                        // –°–∫—Ä—ã—Ç—ã–π —Å–ª–æ–π 256 -> 1024
                        w_hidden1: this._initWeights(256, 1024),
                        b_hidden1: new Array(1024).fill(0),
                        
                        // –°–∫—Ä—ã—Ç—ã–π —Å–ª–æ–π 1024 -> 4096
                        w_hidden2: this._initWeights(1024, 4096),
                        b_hidden2: new Array(4096).fill(0),
                        
                        // –í—ã—Ö–æ–¥–Ω–æ–π —Å–ª–æ–π 4096 -> pixelsCount
                        w_out: this._initWeights(4096, this.pixelsCount),
                        b_out: new Array(this.pixelsCount).fill(0)
                    };
                    
                    log('[MODEL] –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –†–∞–∑–º–µ—Ä –≤—Ö–æ–¥–∞: —Ç–µ–∫—Å—Ç(32) + —à—É–º(128)');
                }
                
                _initWeights(inputSize, outputSize) {
                    const scale = Math.sqrt(2.0 / (inputSize + outputSize));
                    const matrix = [];
                    for (let i = 0; i < inputSize; i++) {
                        const row = [];
                        for (let j = 0; j < outputSize; j++) {
                            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è –±–æ–ª–µ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                            row.push((Math.random() * 2 - 1) * scale * 4);
                        }
                        matrix.push(row);
                    }
                    return matrix;
                }
                
                // –§—É–Ω–∫—Ü–∏–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
                leakyRelu(x, alpha = 0.1) {
                    return x > 0 ? x : alpha * x;
                }
                
                sigmoid(x) {
                    return 1 / (1 + Math.exp(-x));
                }
                
                tanh(x) {
                    return Math.tanh(x);
                }
                
                // –ü—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥ —Å —É—Å–ª–æ–≤–∏–µ–º –Ω–∞ —Ç–µ–∫—Å—Ç
                forward(textEmbedding, temperature = 1.0, detail = 1.0) {
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —à—É–º (–ª–∞—Ç–µ–Ω—Ç–Ω—ã–π –≤–µ–∫—Ç–æ—Ä)
                    const noise = new Array(this.latentDim);
                    for (let i = 0; i < this.latentDim; i++) {
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –¥–ª—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
                        noise[i] = (Math.random() * 2 - 1) * temperature;
                    }
                    
                    // –ö–æ–º–±–∏–Ω–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –∏ —à—É–º —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ª–æ–∏
                    let textFeatures = new Array(256).fill(0);
                    for (let j = 0; j < 256; j++) {
                        let sum = this.weights.b_text[j];
                        for (let i = 0; i < this.inputDim; i++) {
                            sum += textEmbedding[i] * this.weights.w_text[i][j];
                        }
                        textFeatures[j] = this.leakyRelu(sum);
                    }
                    
                    let noiseFeatures = new Array(256).fill(0);
                    for (let j = 0; j < 256; j++) {
                        let sum = this.weights.b_noise[j];
                        for (let i = 0; i < this.latentDim; i++) {
                            sum += noise[i] * this.weights.w_noise[i][j];
                        }
                        noiseFeatures[j] = this.leakyRelu(sum);
                    }
                    
                    // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ñ–∏—á–∏ (–ø–æ—ç–ª–µ–º–µ–Ω—Ç–Ω–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π)
                    let combined = new Array(256);
                    for (let i = 0; i < 256; i++) {
                        combined[i] = (textFeatures[i] + noiseFeatures[i]) * detail;
                    }
                    
                    // –°–∫—Ä—ã—Ç—ã–π —Å–ª–æ–π 1: 256 -> 1024
                    let h1 = new Array(1024).fill(0);
                    for (let j = 0; j < 1024; j++) {
                        let sum = this.weights.b_hidden1[j];
                        for (let i = 0; i < 256; i++) {
                            sum += combined[i] * this.weights.w_hidden1[i][j];
                        }
                        h1[j] = this.leakyRelu(sum);
                    }
                    
                    // –°–∫—Ä—ã—Ç—ã–π —Å–ª–æ–π 2: 1024 -> 4096
                    let h2 = new Array(4096).fill(0);
                    for (let j = 0; j < 4096; j++) {
                        let sum = this.weights.b_hidden2[j];
                        for (let i = 0; i < 1024; i++) {
                            sum += h1[i] * this.weights.w_hidden2[i][j];
                        }
                        h2[j] = this.leakyRelu(sum);
                    }
                    
                    // –í—ã—Ö–æ–¥–Ω–æ–π —Å–ª–æ–π: 4096 -> –ø–∏–∫—Å–µ–ª–∏
                    let output = new Array(this.pixelsCount).fill(0);
                    for (let j = 0; j < this.pixelsCount; j++) {
                        let sum = this.weights.b_out[j];
                        for (let i = 0; i < 4096; i++) {
                            sum += h2[i] * this.weights.w_out[i][j];
                        }
                        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0, 1] –¥–ª—è –ø–∏–∫—Å–µ–ª–µ–π
                        output[j] = this.sigmoid(sum);
                    }
                    
                    return output;
                }
            }
            
            // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ö–û–ú–ü–û–ù–ï–ù–¢–û–í ====================
            const tokenizer = new Tokenizer();
            const encoder = new PromptEncoder(tokenizer);
            const generator = new TextConditionedGenerator();
            
            log('[SWILL] –¢–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω. –†–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è: ' + Object.keys(tokenizer.vocab).length);
            log('[SWILL] –≠–Ω–∫–æ–¥–µ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
            log('[SWILL] –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
            
            // ==================== –§–£–ù–ö–¶–ò–ò –û–¢–†–ò–°–û–í–ö–ò ====================
            function renderImageFromPixels(pixelArray) {
                if (!pixelArray || pixelArray.length !== generator.pixelsCount) {
                    log('[RENDER] –û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ –ø–∏–∫—Å–µ–ª–µ–π');
                    return;
                }
                
                const imageData = ctx.createImageData(generator.imageSize, generator.imageSize);
                
                for (let i = 0; i < pixelArray.length; i++) {
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º [0,1] –≤ [0,255]
                    let val = Math.floor(pixelArray[i] * 255);
                    val = Math.min(255, Math.max(0, val));
                    
                    // –°–æ–∑–¥–∞–µ–º —Ü–≤–µ—Ç–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–∏–∫—Å–µ–ª—è –¥–ª—è –±–æ–ª—å—à–µ–π —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
                    const x = i % generator.imageSize;
                    const y = Math.floor(i / generator.imageSize);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã —Å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –º–æ–¥—É–ª—è—Ü–∏–µ–π
                    let r = val;
                    let g = val;
                    let b = val;
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ –∏ —Ü–≤–µ—Ç–æ–≤—ã—Ö –ø—è—Ç–µ–Ω –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
                    r = Math.min(255, Math.max(0, r + Math.sin(x * 0.05) * 30 + Math.cos(y * 0.03) * 20));
                    g = Math.min(255, Math.max(0, g + Math.cos(x * 0.04) * 25 + Math.sin(y * 0.06) * 15));
                    b = Math.min(255, Math.max(0, b + Math.sin(x * 0.07 + y * 0.02) * 35));
                    
                    imageData.data[i * 4] = r;
                    imageData.data[i * 4 + 1] = g;
                    imageData.data[i * 4 + 2] = b;
                    imageData.data[i * 4 + 3] = 255;
                }
                
                ctx.putImageData(imageData, 0, 0);
                log('[RENDER] –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω–æ –Ω–∞ canvas');
            }
            
            // ==================== –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò ====================
            function generateFromPrompt() {
                const prompt = promptInput.value.trim();
                if (!prompt) {
                    log('[WARN] –ü—Ä–æ–º–ø—Ç –ø—É—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è');
                }
                
                currentPromptDisplay.textContent = prompt || '[—Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–æ–º–ø—Ç]';
                log(`[PROMPT] –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å: "${prompt}"`);
                
                // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                const temperature = parseFloat(temperatureSlider.value);
                const detail = parseFloat(detailSlider.value);
                
                log(`[PARAM] –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${temperature}, –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${detail}`);
                
                // –ö–æ–¥–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –≤ —ç–º–±–µ–¥–¥–∏–Ω–≥
                const textEmbedding = encoder.encode(prompt);
                log(`[ENCODE] –≠–º–±–µ–¥–¥–∏–Ω–≥ –ø–æ–ª—É—á–µ–Ω (–ø–µ—Ä–≤—ã–µ 5 –∑–Ω–∞—á–µ–Ω–∏–π): [${textEmbedding.slice(0, 5).map(v => v.toFixed(3)).join(', ')}...]`);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                log('[GEN] –ó–∞–ø—É—Å–∫ –ø—Ä—è–º–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –Ω–µ–π—Ä–æ—Å–µ—Ç—å...');
                const startTime = performance.now();
                const pixels = generator.forward(textEmbedding, temperature, detail);
                const endTime = performance.now();
                
                log(`[GEN] –ü—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ ${(endTime - startTime).toFixed(0)}–º—Å`);
                
                // –†–µ–Ω–¥–µ—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                renderImageFromPixels(pixels);
                
                log('[DONE] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            }
            
            // ==================== –°–õ–£–ß–ê–ô–ù–´–ô –ü–†–û–ú–ü–¢ ====================
            function randomPrompt() {
                const subjects = ['—á–µ–ª–æ–≤–µ–∫', '–∂–∏—Ä–∞—Ñ', '–∫–æ—Ç', '—Ä–æ–±–æ—Ç', '–¥–µ—Ä–µ–≤–æ', '–¥–æ–º', '—Ü–≤–µ—Ç–æ–∫', '–≥–æ—Ä–∞', '–º–æ—Ä–µ'];
                const attributes = ['–º–∏–ª—ã–π', '—Å—Ç—Ä–∞—à–Ω—ã–π', '—Å–º–µ—à–Ω–æ–π', '–±–æ–ª—å—à–æ–π', '–º–∞–ª–µ–Ω—å–∫–∏–π', '—Ü–≤–µ—Ç–Ω–æ–π', '—á–µ—Ä–Ω—ã–π', '–±–µ–ª—ã–π'];
                const actions = ['—Å–∏–¥–∏—Ç', '—Å—Ç–æ–∏—Ç', '–±–µ–∂–∏—Ç', '—Å–ø–∏—Ç', '—Å–º–æ—Ç—Ä–∏—Ç', '–µ—Å—Ç'];
                const objects = ['—Å —É—Å–∞–º–∏', '–≤ –æ—á–∫–∞—Ö', '–≤ –±—Ä—é–∫–∞—Ö', '–≤ —à–ª—è–ø–µ', '—Å —Ü–≤–µ—Ç–∫–æ–º', '—Å –º—è—á–æ–º'];
                
                const subject = subjects[Math.floor(Math.random() * subjects.length)];
                const attr = attributes[Math.floor(Math.random() * attributes.length)];
                const action = actions[Math.floor(Math.random() * actions.length)];
                const obj = objects[Math.floor(Math.random() * objects.length)];
                
                const prompts = [
                    `–Ω–∞—Ä–∏—Å—É–π –º–Ω–µ ${attr} ${subject} ${obj}`,
                    `—Å–æ–∑–¥–∞–π ${attr} ${subject} –∫–æ—Ç–æ—Ä—ã–π ${action}`,
                    `–∏–∑–æ–±—Ä–∞–∑–∏ ${subject} ${obj} –∏ ${action}`,
                    `${attr} ${subject} ${obj} ${action}`
                ];
                
                return prompts[Math.floor(Math.random() * prompts.length)];
            }
            
            // ==================== –£–õ–£–ß–®–ï–ù–ò–ï –ü–†–û–ú–ü–¢–ê ====================
            function enhancePrompt() {
                const current = promptInput.value.trim();
                if (!current) {
                    promptInput.value = randomPrompt();
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è "—É–ª—É—á—à–µ–Ω–∏—è"
                    const enhancers = ['–∫—Ä–∞—Å–∏–≤—ã–π', '—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π', '–¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π', '—è—Ä–∫–∏–π', '—Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∏–π'];
                    const enhancer = enhancers[Math.floor(Math.random() * enhancers.length)];
                    promptInput.value = `${enhancer} ${current}`;
                }
                log('[ENHANCE] –ü—Ä–æ–º–ø—Ç —É–ª—É—á—à–µ–Ω');
            }
            
            // ==================== –°–û–•–†–ê–ù–ï–ù–ò–ï –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø ====================
            function downloadImage() {
                const link = document.createElement('a');
                link.download = `swill-t2i-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                log('[SAVE] –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
            }
            
            // ==================== –ü–†–ò–í–Ø–ó–ö–ê –°–û–ë–´–¢–ò–ô ====================
            generateBtn.addEventListener('click', () => {
                log('[ACTION] –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                generateFromPrompt();
            });
            
            randomPromptBtn.addEventListener('click', () => {
                const rp = randomPrompt();
                promptInput.value = rp;
                log(`[RANDOM] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–æ–º–ø—Ç: "${rp}"`);
                generateFromPrompt();
            });
            
            enhanceBtn.addEventListener('click', () => {
                enhancePrompt();
            });
            
            downloadBtn.addEventListener('click', downloadImage);
            
            // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ====================
            window.onload = function() {
                log('[SYSTEM] SWILL Text-to-Image Neural Engine v2.0');
                log('[SYSTEM] –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 26.09.2025');
                log('[SYSTEM] –†–µ–∂–∏–º: –ë–ï–ó –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ô');
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                setTimeout(() => {
                    generateFromPrompt();
                }, 500);
            };
            
            // –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π –æ–± –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö
            log('[CHECK] –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–±–æ–µ–≤...');
            log('[CHECK] –≠—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã: –ù–ï –û–ë–ù–ê–†–£–ñ–ï–ù–´');
            log('[CHECK] –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ SWILL');
            
        })();
    </script>
</body>
</html>
